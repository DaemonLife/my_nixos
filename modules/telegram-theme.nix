{ config, lib, pkgs, ... }: {

  home.file.".config/colors.tdesktop-theme".text =
    with config.lib.stylix.colors; ''
      windowBg: #${base00};
      windowFg: #${base05};

      scrollBgOver: #${base01};
      historyScrollBarBg: windowFg;

      windowBgOver: #${base00};
      windowBgRipple: #${base08};
      windowFgOver: windowFg;
      windowSubTextFg: windowFg;
      windowSubTextFgOver: #${base0D};
      windowBoldFg: windowFg;
      windowBoldFgOver: #${base0D};
      windowBgActive: #${base0D};
      windowFgActive: #${base00};
      windowActiveTextFg: windowFg;
      windowShadowFg: #00000000;
      windowShadowFgFallback: #00000000;
      shadowFg: #00000000;
      slideFadeOutBg: #00000000;
      slideFadeOutShadowFg: #00000000;
      imageBg: #00000088;
      imageBgTransparent: #00000088;
      activeButtonBg: #${base01};
      activeButtonBgOver: #${base01};
      activeButtonBgRipple: #${base02};
      activeButtonFg: windowFg;
      activeButtonFgOver: activeButtonFg;
      activeButtonSecondaryFg: windowFg;
      activeButtonSecondaryFgOver: windowFg;
      activeLineFg: windowFg;
      activeLineFgError: #${base08};
      lightButtonBg: #${base01};
      lightButtonBgOver: #${base01};
      lightButtonBgRipple: #${base02};
      lightButtonFg: activeButtonFg;
      lightButtonFgOver: lightButtonFg;
      attentionButtonFg: #${base08};
      attentionButtonFgOver: #${base08};
      attentionButtonBgOver: #${base08}1d;
      attentionButtonBgRipple: #${base08};
      outlineButtonBg: #${base00};
      outlineButtonBgOver: lightButtonBgOver;
      outlineButtonOutlineFg: windowBgActive;
      outlineButtonBgRipple: lightButtonBgRipple;
      menuBg: #${base00};
      menuBgOver: windowBgOver;
      menuBgRipple: windowBgRipple;
      menuIconFg: windowFg;
      menuIconFgOver: #${base03};
      menuSubmenuArrowFg: #${base03};
      menuFgDisabled: #${base03};
      menuSeparatorFg: windowFg;
      scrollBarBg: #${base01};
      scrollBarBgOver: #${base01};
      scrollBg: #${base01};
      smallCloseIconFg: windowFg;
      smallCloseIconFgOver: #${base03};
      radialFg: windowFg;
      radialBg: #${base00};
      placeholderFg: windowSubTextFg;
      placeholderFgActive: #${base03};
      inputBorderFg: #${base03};
      filterInputBorderFg: #${base02};
      filterInputInactiveBg: #${base02};
      checkboxFg: windowFg;
      sliderBgInactive: #${base01};
      sliderBgActive: windowFg;
      tooltipBg: #${base07};
      tooltipFg: #${base0D};
      tooltipBorderFg: windowFg;
      titleShadow: #00000000;
      titleBg: #${base00};
      titleBgActive: #${base01};
      titleButtonBg: titleBg;
      titleButtonFg: #${base03};
      titleButtonBgOver: #${base00};
      titleButtonFgOver: windowFg;
      titleButtonBgActive: titleButtonBg;
      titleButtonFgActive: titleButtonFg;
      titleButtonBgActiveOver: titleButtonBgOver;
      titleButtonFgActiveOver: windowFg;
      titleButtonCloseBg: titleButtonBg;
      titleButtonCloseFg: titleButtonFg;
      titleButtonCloseBgOver: #${base08};
      titleButtonCloseFgOver: windowFg;
      titleButtonCloseBgActive: titleButtonCloseBg;
      titleButtonCloseFgActive: windowBoldFg;
      titleButtonCloseBgActiveOver: #${base08};
      titleButtonCloseFgActiveOver: titleButtonCloseFgOver;
      titleFgActive: windowBoldFg;
      titleFg: windowSubTextFg;
      trayCounterBg: #${base01};
      trayCounterBgMute: #${base04};
      trayCounterFg: windowFg;
      trayCounterBgMacInvert: windowFg;
      trayCounterFgMacInvert: #${base00};
      layerBg: #0000007f;
      cancelIconFg: menuIconFg;
      cancelIconFgOver: menuIconFgOver;
      boxBg: #${base00};
      boxTextFg: windowFg;
      boxTextFgGood: #${base0B};
      boxTextFgError: #${base08};
      boxTitleFg: windowFg;
      boxSearchBg: #${base01};
      boxTitleAdditionalFg: #${base03};
      boxTitleCloseFg: cancelIconFg;
      boxTitleCloseFgOver: cancelIconFgOver;
      membersAboutLimitFg: windowSubTextFgOver;
      contactsBg: #${base00};
      contactsBgOver: windowBgOver;
      contactsNameFg: boxTextFg;
      contactsStatusFg: windowSubTextFg;
      contactsStatusFgOver: windowSubTextFgOver;
      contactsStatusFgOnline: windowFg;
      photoCropFadeBg: #${base01}7f;
      photoCropPointFg: #${base03}7f;
      introBg: #${base00};
      introTitleFg: windowFg;
      introDescriptionFg: windowSubTextFg;
      introErrorFg: #${base04};
      introCoverTopBg: #${base00};
      introCoverBottomBg: #${base00};
      introCoverIconsFg: #${base00};
      introCoverPlaneTrace: #${base04};
      introCoverPlaneInner: #${base03};
      introCoverPlaneOuter: #${base04};
      introCoverPlaneTop: #${base03};
      dialogsMenuIconFg: menuIconFg;
      dialogsMenuIconFgOver: menuIconFgOver;
      dialogsBg: #${base00};
      dialogsNameFg: windowFg;
      dialogsChatIconFg: dialogsNameFg;
      dialogsDateFg: windowFg;
      dialogsTextFg: #${base04};
      dialogsTextFgService: windowActiveTextFg;
      dialogsDraftFg: #${base0A};
      dialogsVerifiedIconBg: windowFg;
      dialogsVerifiedIconFg: #${base01};
      dialogsSendingIconFg: windowFg;
      dialogsSentIconFg: windowFg;
      dialogsUnreadBg: windowFg;
      dialogsUnreadBgMuted: #${base04};
      dialogsUnreadFg: #${base01};
      dialogsBgOver: #${base01};
      dialogsNameFgOver: #${base06};
      dialogsChatIconFgOver: #${base06};
      dialogsDateFgOver: #${base06};
      dialogsTextFgOver: windowSubTextFgOver;
      dialogsTextFgServiceOver: dialogsTextFgService;
      dialogsDraftFgOver: dialogsDraftFg;
      dialogsVerifiedIconBgOver: dialogsVerifiedIconBg;
      dialogsVerifiedIconFgOver: dialogsVerifiedIconFg;
      dialogsSendingIconFgOver: dialogsSendingIconFg;
      dialogsSentIconFgOver: dialogsSentIconFg;
      dialogsUnreadBgOver: dialogsUnreadBg;
      dialogsUnreadBgMutedOver: dialogsUnreadBgMuted;
      dialogsUnreadFgOver: dialogsUnreadFg;
      dialogsBgActive: #${base01};
      dialogsNameFgActive: #${base06};
      dialogsChatIconFgActive: #${base06};
      dialogsDateFgActive: windowFg;
      dialogsTextFgActive: windowFg;
      dialogsTextFgServiceActive: windowFg;
      dialogsDraftFgActive: windowSubTextFg;
      dialogsVerifiedIconBgActive: windowFg;
      dialogsVerifiedIconFgActive: dialogsVerifiedIconFg;
      dialogsSendingIconFgActive: dialogsSendingIconFg;
      dialogsSentIconFgActive: windowFg;
      dialogsUnreadBgActive: windowFg;
      dialogsUnreadBgMutedActive: dialogsUnreadBgMuted;
      dialogsUnreadFgActive: dialogsUnreadFg;
      dialogsForwardBg: dialogsBgActive;
      dialogsForwardFg: dialogsNameFgActive;
      searchedBarBg: #${base00};
      searchedBarFg: windowFg;
      topBarBg: #${base00};
      emojiPanBg: #${base00};
      emojiPanCategories: #${base00};
      emojiPanHeaderFg: windowFg;
      emojiPanHeaderBg: #${base03};
      stickerPanDeleteBg: #${base01};
      stickerPanDeleteFg: windowFg;
      stickerPreviewBg: #${base00}80;
      historyTextInFg: windowFg;
      historyTextInFgSelected: #${base00};
      historyTextOutFg: windowFg;
      historyCaptionInFg: historyTextInFg;
      historyCaptionOutFg: historyTextOutFg;
      historyFileNameInFg: historyTextInFg;
      historyFileNameOutFg: historyTextOutFg;
      historyOutIconFg: dialogsSentIconFg;
      historyOutIconFgSelected: #${base00};
      historyIconFgInverted: windowFg;
      historySendingOutIconFg: #${base04};
      historySendingInIconFg: #${base04};
      historySendingInvertedIconFg: windowFg;
      historyUnreadBarBg: #${base00};
      historyUnreadBarBorder: shadowFg;
      historyUnreadBarFg: #${base05};
      historyForwardChooseBg: #${base03}80;
      historyForwardChooseFg: windowFg;
      historyPeer1NameFg: #${base08};
      historyPeer1UserpicBg: #${base08};
      historyPeer2NameFg: #${base0B};
      historyPeer2UserpicBg: #${base0B};
      historyPeer3NameFg: #${base0A};
      historyPeer3UserpicBg: #${base0A};
      historyPeer4NameFg: #${base0C};
      historyPeer4UserpicBg: #${base0C};
      historyPeer5NameFg: #${base09};
      historyPeer5UserpicBg: #${base09};
      historyPeer6NameFg: #${base0E};
      historyPeer6UserpicBg: #${base0E};
      historyPeer7NameFg: #${base0D};
      historyPeer7UserpicBg: #${base0D};
      historyPeer8NameFg: #${base0F};
      historyPeer8UserpicBg: #${base0F};
      historyPeerUserpicFg: #${base01};
      historyScrollBarBgOver: windowFg;
      historyScrollBg: #${base01};
      historyScrollBgOver: windowFg;
      msgInBg: #${base01};
      msgInBgSelected: #${base0D};
      msgOutBg: #${base01};
      msgOutBgSelected: #${base0D}ff;
      msgSelectOverlay: #${base0D}ff;
      msgStickerOverlay: #${base0D}ff;
      msgInServiceFg: windowFg;
      msgInServiceFgSelected: windowFg;
      msgOutServiceFg: #${base0D};
      msgOutServiceFgSelected: activeLineFg;
      msgInShadow: #00000000;
      msgInShadowSelected: #00000000;
      msgOutShadow: #00000000;
      msgOutShadowSelected: #00000000;
      msgInDateFg: windowFg;
      msgInDateFgSelected: #${base00};
      msgOutDateFg: windowFg;
      msgOutDateFgSelected: #${base00};
      msgServiceFg: #${base05};
      msgServiceBg: #${base01};
      msgServiceBgSelected: #${base02};
      msgInReplyBarColor: windowFg;
      msgInReplyBarSelColor: windowFg;
      msgOutReplyBarColor: windowFg;
      msgOutReplyBarSelColor: windowFg;
      msgImgReplyBarColor: windowFg;
      msgInMonoFg: windowFg;
      msgOutMonoFg: windowFg;
      msgDateImgFg: windowFg;
      msgDateImgBg: #${base01};
      msgDateImgBgOver: #${base01};
      msgDateImgBgSelected: #${base00};
      msgFileThumbLinkInFg: lightButtonFg;
      msgFileThumbLinkInFgSelected: lightButtonFgOver;
      msgFileThumbLinkOutFg: windowActiveTextFg;
      msgFileThumbLinkOutFgSelected: windowActiveTextFg;
      msgFileInBg: #${base00};
      msgFileInBgOver: windowSubTextFgOver;
      msgFileInBgSelected: windowBoldFg;
      msgFileOutBg: windowBoldFg;
      msgFileOutBgOver: windowSubTextFgOver;
      msgFileOutBgSelected: windowBoldFg;
      msgFile1Bg: #${base01};
      msgFile1BgDark: #${base05};
      msgFile1BgOver: #${base04};
      msgFile1BgSelected: #${base04};
      msgFile2Bg: #${base01};
      msgFile2BgDark: #${base05};
      msgFile2BgOver: #${base04};
      msgFile2BgSelected: #${base04};
      msgFile3Bg: #${base01};
      msgFile3BgDark: #${base05};
      msgFile3BgOver: #${base04};
      msgFile3BgSelected: #${base04};
      msgFile4Bg: #${base01};
      msgFile4BgDark: #${base05};
      msgFile4BgOver: #${base04};
      msgFile4BgSelected: #${base04};
      historyFileInIconFg: #${base01};
      historyFileInIconFgSelected: #${base0D};
      historyFileInRadialFg: historyFileInIconFg;
      historyFileInRadialFgSelected: historyFileInIconFgSelected;
      historyFileOutIconFg: msgOutBg;
      historyFileOutIconFgSelected: #${base0D};
      historyFileOutRadialFg: historyFileOutIconFg;
      historyFileOutRadialFgSelected: historyFileOutIconFgSelected;
      historyFileThumbIconFg: msgInBg;
      historyFileThumbIconFgSelected: #${base0D};
      historyFileThumbRadialFg: historyFileThumbIconFg;
      historyFileThumbRadialFgSelected: historyFileThumbIconFgSelected;
      msgWaveformInActive: #${base0D};
      msgWaveformInActiveSelected: windowFg;
      msgWaveformInInactive: #${base03};
      msgWaveformInInactiveSelected: #${base02};
      msgWaveformOutActive: windowFg;
      msgWaveformOutActiveSelected: #${base02};
      msgWaveformOutInactive: #${base01};
      msgWaveformOutInactiveSelected: msgInBgSelected;
      msgBotKbOverBgAdd: msgServiceBg;
      msgBotKbIconFg: msgServiceFg;
      msgBotKbRippleBg: menuBgRipple;
      mediaInFg: msgInDateFg;
      mediaInFgSelected: msgInDateFgSelected;
      mediaOutFg: msgOutDateFg;
      mediaOutFgSelected: msgOutDateFgSelected;
      youtubePlayIconBg: #00000080;
      youtubePlayIconFg: windowFg;
      videoPlayIconBg: #00000080;
      videoPlayIconFg: #${base05};
      toastBg: #${base00};
      toastFg: windowFg;
      reportSpamBg: #${base00};
      reportSpamFg: windowFg;
      historyToDownBg: #00000000;
      historyToDownBgOver: #00000080;
      historyToDownBgRipple: windowBgRipple;
      historyToDownFg: windowFg;
      historyToDownFgOver: windowFg;
      historyToDownShadow: #00000000;
      historyComposeAreaBg: #${base00};
      historyComposeAreaFg: historyTextInFg;
      historyComposeAreaFgService: windowFg;
      historyComposeIconFg: windowFg;
      historyComposeIconFgOver: windowFg;
      historySendIconFg: windowFg;
      historySendIconFgOver: windowFg;
      historyPinnedBg: #${base00};
      historyReplyBg: historyComposeAreaBg;
      historyReplyIconFg: historyTextInFg;
      historyReplyCancelFg: windowFg;
      historyReplyCancelFgOver: windowFg;
      historyComposeButtonBg: historyComposeAreaBg;
      historyComposeButtonBgOver: windowBgOver;
      historyComposeButtonBgRipple: windowBgRipple;
      overviewCheckBg: #${base03}80;
      overviewCheckFg: #${base04};
      overviewCheckFgActive: #${base01};
      overviewPhotoSelectOverlay: #bdbdbd4a;
      profileStatusFgOver: #${base04};
      profileVerifiedCheckBg: windowFg;
      profileVerifiedCheckFg: #${base01};
      profileAdminStartFg: windowFg;
      notificationsBoxMonitorFg: windowFg;
      notificationsBoxScreenBg: windowSubTextFg;
      notificationSampleUserpicFg: #${base01};
      notificationSampleCloseFg: windowFg;
      notificationSampleTextFg: windowFg;
      notificationSampleNameFg: #${base04};
      mainMenuBg: #${base00};
      mainMenuCoverBg: #${base00};
      mainMenuCoverFg: windowFg;
      mediaPlayerBg: #${base00};
      mediaPlayerActiveFg: windowFg;
      mediaPlayerInactiveFg: #${base03};
      mediaPlayerDisabledFg: #${base03};
      mediaviewFileBg: #000000;
      mediaviewFileNameFg: windowFg;
      mediaviewFileSizeFg: windowSubTextFg;
      mediaviewFileRedCornerFg: #${base08};
      mediaviewFileYellowCornerFg: #${base0A};
      mediaviewFileGreenCornerFg: #${base0B};
      mediaviewFileBlueCornerFg: #${base0D};
      mediaviewFileExtFg: activeButtonFg;
      mediaviewMenuBg: #${base00};
      mediaviewMenuBgOver: menuBgOver;
      mediaviewMenuBgRipple: menuBgRipple;
      mediaviewMenuFg: windowBoldFg;
      mediaviewBg: #000000;
      mediaviewVideoBg: imageBg;
      mediaviewControlBg: #${base07}80;
      mediaviewControlFg: windowFg;
      mediaviewCaptionBg: #00000080;
      mediaviewCaptionFg: windowFg;
      mediaviewTextLinkFg: #${base0D};
      mediaviewSaveMsgBg: toastBg;
      mediaviewSaveMsgFg: toastFg;
      mediaviewPlaybackActive: windowFg;
      mediaviewPlaybackInactive: #${base02};
      mediaviewPlaybackActiveOver: windowFg;
      mediaviewPlaybackInactiveOver: windowSubTextFgOver;
      mediaviewPlaybackProgressFg: #${base03};
      mediaviewPlaybackIconFg: mediaviewPlaybackActive;
      mediaviewPlaybackIconFgOver: mediaviewPlaybackActiveOver;
      mediaviewTransparentBg: #000000ff;
      mediaviewTransparentFg: windowFg;
      notificationBg: #${base00};

      emojiIconFg: windowFg;
      historyLinkOutFg: #${base08};
      historyLinkInFg: #${base08};
      sideBarBg: #${base00};
      sideBarBgActive: #${base01};
      sideBarTextFgActive: #${base0D};
      sideBarIconFgActive: #${base0D};
      sideBarBadgeBg: #${base0D};
      sideBarTextFg: #${base03};
      sideBarBadgeBgMuted: #${base03};
      sideBarBgRipple: #${base08};
      sideBarIconFg: #${base03};
      mainMenuCloudBg: #${base03};
      filterInputActiveBg: #${base0D};
      overviewCheckBorder: #${base08};
      sideBarBadgeFg: #${base00};
      dialogsOnlineBadgeFgActive: #${base08};
      walletTitleButtonCloseFgActiveOver: #${base08};
    '';

  home.activation = with config.lib.stylix.colors; {
    test = lib.hm.dag.entryAfter [ "writeBoundary" ] ''
      ${pkgs.imagemagick}/bin/magick -size 2960x2960 xc:#${base00} ~/.config/background.jpg
      cd ~/.config && ${pkgs.zip}/bin/zip telegram-base16.zip background.jpg colors.tdesktop-theme && rm -rf colors.tdesktop-theme background.jpg && mv telegram-base16.zip telegram-base16.tdesktop-theme
    '';
  };

}
